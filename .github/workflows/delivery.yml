name: Delivery
on:
  workflow_dispatch:
jobs:
  delivery:
    name: Delivery
    runs-on: macos-13
    env:
      GIT_USER: ${{ secrets.GIT_USER }}
      GIT_EMAIL: ${{ secrets.GIT_EMAIL }}
      GPG_PASSWORD: ${{ secrets.GPG_PASSWORD }}
      GPG_PRIVATE_KEY: ${{ secrets.GPG_PRIVATE_KEY }}
      GRADLE_CACHE_CLEANUP: true
      SONATYPE_PORTAL_USERNAME: ${{ secrets.SONATYPE_PORTAL_USERNAME }}
      SONATYPE_PORTAL_PASSWORD: ${{ secrets.SONATYPE_PORTAL_PASSWORD }}
    steps:
      - name: Checkout code
        uses: actions/checkout@v4.2.2
      - name: Setup Java
        uses: actions/setup-java@v4.7.0
        with:
          distribution: temurin
          java-version: 17
      - name: Setup Gradle
        uses: gradle/actions/setup-gradle@v4.3.1
      - name: Deliver 'types-internal' subproject
        run: ./gradlew :types-internal:publishAllPublicationsToOSSRHRepository
      - name: Deliver 'types' subproject
        run: ./gradlew :types:publishAllPublicationsToOSSRHRepository
      - name: Deliver 'types-kotlinx-serialization' subproject
        run: |
          ./gradlew \
            :types-kotlinx-serialization:publishAllPublicationsToOSSRHRepository
